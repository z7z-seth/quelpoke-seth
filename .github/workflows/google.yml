# Le nom de votre workflow
name: quelpoke

# Quand est-ce que ce robot doit s'activer ?
on:
  push:
    branches: [ "main" ] # Ici, il s'active dès qu'on envoie du code sur la branche 'main'

jobs:
  build-and-push:
    runs-on: ubuntu-latest # On utilise un ordinateur virtuel Linux fourni par GitHub

    steps:
      # Étape 1 : Copier votre code sur l'ordinateur virtuel
      - uses: actions/checkout@v3
      - uses: google-github-actions/auth@v2
        with:
          credentials_json: ${{ secrets.service_account }}
      - uses: google-github-actions/setup-gcloud@v2
        with: 
          project_id: cs-poc-hpzdycpiqjyvinhrczvlwcn 
      
      - run: gloud auth configure-docker europe-west9-docker.pkg.dev
      - run: docker build -t europe-west9-docker.pkg.dev/cs-poc-hpzdycpiqjyvinhrczvlwcn/student-seth .
      - run: docker push europe-west9-docker.pkg.dev/cs-poc-hpzdycpiqjyvinhrczvlwcn/student-seth/quelpoke:latest
